"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();!function(window,d3){var GraphNames;(function(){function Utility(){_classCallCheck(this,Utility)}return _createClass(Utility,[{key:"defineReadonly",value:function(obj,key,value){Object.defineProperty(obj,key,{configurable:!0,value:value,writable:!1})}}]),Utility})();!function(GraphNames){GraphNames[GraphNames.stacked=1]="stacked"}(GraphNames||(GraphNames={}));var Stacked=function(){function Stacked(options){_classCallCheck(this,Stacked),this.options=options,this.listeners=[]}return _createClass(Stacked,[{key:"draw",value:function(updatedData){var that=this,options=that.options,defaults=DrawIt.defaults,data=updatedData||options.data,selector=options.selector;if(!selector||!data)throw"Missing data and selector";var height=options.dim?options.dim.height||defaults.height:defaults.height,width=options.dim?options.dim.width||defaults.width:defaults.width,margin={top:20,right:20,bottom:30,left:50};width=width-margin.left-margin.right,height=height-margin.top-margin.bottom,that.stack=d3.layout.stack().values(function(d){return d.values}).x(function(d){return new Date(Date.parse(d.date))}).y(function(d){return d.count});var stacked=that.stack(data);that.maxY=d3.max(stacked,function(d){return d3.max(d.values,function(d){return d.y0+d.y})}),that.yScale=d3.scale.linear().range([height,0]).domain([0,that.maxY]),that.xScale=d3.time.scale().range([0,width]).domain(d3.extent(data[0].values,function(d){return new Date(Date.parse(d.date))})).nice(4),that.svg=d3.select("body").append(selector).attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),that.colors=options.colors||d3.scale.category10(),that.layers=that.svg.selectAll("g.layer").data(stacked,function(d){return d.name}).enter().append("g").attr("class","layer").attr("fill",function(d){return that.colors(d.name)}),that.layers.selectAll("rect").data(function(d){return d.values}).enter().append("rect").attr("x",function(d){return that.xScale(new Date(Date.parse(d.date)))}).attr("width",width/3).attr("y",function(d){return that.yScale(d.y0+d.y)}).attr("height",function(d){return height-that.yScale(d.y)})}},{key:"on",value:function(prop,event,callback){var that=this;if("undefined"==typeof that[prop])throw"Event can't bind to "+prop;that[prop].on(event,callback);var unbind=function(){console.log("Stopping listening events "+prop+":"+event),that[prop].on(event,null),that.listeners=that.listeners.filter(function(l){return l.id!==listener.id})},listener={id:that.listeners.length,event:event,prop:prop,callback:callback,unbind:unbind};return that.listeners.push(listener),listener}},{key:"unbind",value:function(id){var listener=this.listeners[id];listener&&(console.log("Stopping listening events "+listener.prop+":"+listener.event),this[listener.prop].on(listener.event,null),this.listeners=this.listeners.filter(function(l){return l.id!==listener.id}))}}]),Stacked}(),DrawIt=function DrawIt(options){_classCallCheck(this,DrawIt);var chart=void 0;switch(options.type){case GraphNames.stacked:chart=new Stacked(options);break;default:throw"Invalid graph "+options.type+"!"}return chart};return DrawIt.defaults={height:600,width:600},DrawIt.GraphNames=GraphNames,window?(window.DI=DrawIt,window.DrawIt=DrawIt):module?module.exports=DrawIt:void 0}(window,window.d3);